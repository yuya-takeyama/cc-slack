---
title: Webマネジメントコンソールの実装
status: draft
---

# Webマネジメントコンソールの実装

cc-slack のセッション情報を可視化し、管理するためのWeb UIを実装する。

## 目的

- セッション履歴を一覧で確認
- コスト情報や統計データの可視化
- 実行中のセッションのリアルタイムモニタリング
- モバイルからでもアクセス可能な管理画面

## 前提条件

- データベース統合が完了していること（002-database-integration.md）
- セッション情報がDBに保存されていること

## タスクリスト

### Phase 1: バックエンドAPI（2日）

#### 1.1 基本的なWebサーバー設定
- [ ] `/web/*` パスのルーティング追加
- [ ] gorilla/mux でのサブルーター設定
- [ ] CORS設定（開発時はlocalhost:3000を許可）

#### 1.2 RESTful API実装
- [ ] `GET /web/api/threads` - スレッド一覧
- [ ] `GET /web/api/threads/:id` - スレッド詳細
- [ ] `GET /web/api/sessions` - セッション一覧（ページネーション付き）
- [ ] `GET /web/api/sessions/:id` - セッション詳細
- [ ] `GET /web/api/stats` - 統計情報（総コスト、セッション数、平均実行時間）
- [ ] エラーハンドリングとレスポンスフォーマット統一

#### 1.3 リアルタイム更新
- [ ] `GET /web/api/sessions/:id/stream` - Server-Sent Events実装
- [ ] アクティブセッションの状態変更をプッシュ
- [ ] 接続管理とクリーンアップ

### Phase 2: フロントエンドUI（3日）

#### 2.1 基本レイアウト
- [ ] 静的HTMLファイルの配信設定
- [ ] Tailwind CSS（CDN版）の導入
- [ ] レスポンシブデザイン（モバイル・デスクトップ）
- [ ] ナビゲーションバー

#### 2.2 ページ実装
- [ ] ダッシュボード（統計サマリー）
- [ ] セッション一覧ページ
  - [ ] フィルタリング（日付、ステータス、チャンネル）
  - [ ] ソート機能（コスト、実行時間、日付）
  - [ ] ページネーション
- [ ] セッション詳細ページ
  - [ ] 基本情報（開始/終了時刻、コスト、トークン数）
  - [ ] スレッドへのリンク
  - [ ] リアルタイム更新（アクティブセッションの場合）

#### 2.3 統計ビュー
- [ ] 日別/週別/月別のコストグラフ
- [ ] セッション数の推移
- [ ] 平均実行時間の表示
- [ ] Chart.js または同等のライブラリで可視化

### Phase 3: セキュリティと運用機能（1日）

#### 3.1 認証
- [ ] Basic認証の実装
- [ ] 環境変数での認証情報設定
- [ ] セッション管理（Cookieベース）

#### 3.2 運用機能
- [ ] Rate limiting（1分あたり60リクエストまで）
- [ ] アクセスログ
- [ ] エラーログ
- [ ] ヘルスチェックエンドポイント（`/web/health`）

### Phase 4: 拡張機能（オプション）

#### 4.1 高度な機能
- [ ] セッションのエクスポート（CSV/JSON）
- [ ] カスタムダッシュボード
- [ ] アラート設定（コスト閾値超過時）
- [ ] セッションの手動停止機能

#### 4.2 UI/UX改善
- [ ] ダークモード対応
- [ ] リアルタイム通知（トースト）
- [ ] キーボードショートカット
- [ ] 検索機能の強化

#### 4.3 データ分析機能
- [ ] メッセージログの表示（messages テーブルの活用）
- [ ] ツール実行履歴（tool_executions テーブルの活用）
- [ ] 使用頻度の高いツールの分析
- [ ] エラー発生率の可視化

#### 4.4 運用機能
- [ ] データベースのバックアップ機能
- [ ] メトリクス収集（Prometheus形式）
  - [ ] `/metrics` エンドポイント
  - [ ] セッション数、実行時間、コストのメトリクス
- [ ] 監視ダッシュボードとの連携

## 実装例

### APIレスポンス例
```json
// GET /web/api/sessions
{
  "sessions": [
    {
      "id": 1,
      "session_id": "f0b25458-564a-40fc-963c-21a837ac8c0e",
      "thread_ts": "1234567890.123456",
      "channel_id": "C1234567890",
      "status": "completed",
      "started_at": "2025-01-27T10:00:00Z",
      "ended_at": "2025-01-27T10:30:00Z",
      "total_cost_usd": 0.294,
      "input_tokens": 15368,
      "output_tokens": 1245
    }
  ],
  "total": 150,
  "page": 1,
  "per_page": 20
}
```

### UI モックアップ

#### メイン画面（スレッドベースのナビゲーション）
```
┌─────────────────────────────────────────────┐
│ cc-slack Management Console     [Logout]    │
├─────────────────────────────────────────────┤
│ ┌─────────┐ ┌─────────────────────────────┐│
│ │Thread   │ │Session Details              ││
│ │List     │ │                             ││
│ │         │ │ Thread: #general 1234567    ││
│ │#general │ │ Sessions: 3                 ││
│ │ └sess1  │ │ Total Cost: $1.25           ││
│ │ └sess2  │ │                             ││
│ │ └sess3  │ │ ┌─────────────────────────┐ ││
│ │         │ │ │sess1: $0.45 (Completed)│ ││
│ │#project │ │ │sess2: $0.35 (Completed)│ ││
│ │ └sess4  │ │ │sess3: $0.45 (Running)  │ ││
│ └─────────┘ │ └─────────────────────────┘ ││
└─────────────┴───────────────────────────────┘
```

#### ダッシュボード画面
```
┌─────────────────────────────────────────────┐
│ cc-slack Management Console     [Logout]    │
├─────────────────────────────────────────────┤
│ Dashboard | Threads | Statistics           │
├─────────────────────────────────────────────┤
│ Today's Summary                             │
│ ┌─────────┐ ┌─────────┐ ┌─────────┐       │
│ │Sessions │ │  Cost   │ │ Tokens  │       │
│ │   15    │ │ $2.45   │ │ 125.4k  │       │
│ └─────────┘ └─────────┘ └─────────┘       │
│                                             │
│ Recent Sessions                             │
│ ┌─────────────────────────────────────┐    │
│ │#general  10:25 AM  $0.29  ✓       │    │
│ │#project  09:45 AM  $0.15  ✓       │    │
│ │#general  09:00 AM  $0.45  Running │    │
│ └─────────────────────────────────────┘    │
└─────────────────────────────────────────────┘
```

## 技術スタック

- **バックエンド**: 既存のGo HTTPサーバーを拡張
- **フロントエンド**: 
  - Vanilla JavaScript または Alpine.js（軽量性重視）
  - Tailwind CSS（CDN版）
  - Chart.js（グラフ表示）
- **データ取得**: Fetch API
- **リアルタイム**: Server-Sent Events

## ディレクトリ構造

```
internal/
  web/
    handler.go      # HTTPハンドラー
    api.go          # REST APIエンドポイント
    sse.go          # Server-Sent Events
    static/         # 静的ファイル（HTML/CSS/JS）
```

## 設定

```yaml
# config.yaml
web:
  enabled: true
  auth:
    username: ${WEB_AUTH_USERNAME}
    password: ${WEB_AUTH_PASSWORD}
  rate_limit:
    requests_per_minute: 60
```

## 期待される成果

- セッション履歴を一目で確認できる
- コスト管理が容易になる
- モバイルからでも管理が可能
- 異常なセッションの早期発見