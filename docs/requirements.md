# cc-slack 要求仕様書（PRD）

## 概要

cc-slack は Claude Code と Slack 上でインタラクションするためのソフトウェアです。[cchh #16](https://github.com/yuya-takeyama/cchh/issues/16) で検討された「ゴロ寝コンピューティング」の問題に対する別アプローチとして、Slack 上で直接 Claude Code とやり取りすることで、よりシームレスな体験を提供します。

## 背景と動機

### 解決したい課題

1. **リモートワーク環境での Claude Code 利用**
   - ターミナルに張り付く必要がない
   - どこからでも作業の進捗を確認できる
   - モバイルデバイスからでも指示を出せる

2. **チームでの共同作業**
   - Slack スレッドで Claude Code の作業履歴を共有
   - チームメンバーが作業の流れを追跡可能
   - 非エンジニアメンバーも AI アシスタントの活用が可能

3. **非同期コミュニケーション**
   - 長時間実行タスクの進捗をSlackで確認
   - 必要に応じて途中で指示を追加

## 機能要件

### コア機能

1. **Slack Bot インターフェース**
   - メンションによる Claude Code セッション開始
   - スレッド内での継続的な対話
   - 作業進捗のリアルタイム表示

2. **Claude Code プロセス管理**
   - セッションごとの独立したプロセス
   - 適切なライフサイクル管理
   - リソースの自動クリーンアップ

3. **MCP (Model Context Protocol) 統合**
   - approval_prompt による Slack 上での承認フロー
   - カスタムツールの提供
   - セキュアな通信

### 拡張機能

1. **セッション再開機能**
   - 同一スレッド内でのセッション継続（--resume）
   - コンテキストの保持
   - タイムアウト後の再接続

2. **データ永続化**
   - セッション情報の保存
   - 実行履歴の記録
   - コスト追跡

3. **Web管理コンソール**
   - セッション履歴の可視化
   - 統計情報の表示
   - リアルタイムモニタリング

4. **柔軟な設定管理**
   - 環境変数と設定ファイルのサポート
   - チャンネルごとの設定
   - 複数ワーキングディレクトリ対応

## 非機能要件

### パフォーマンス
- 複数セッションの並列実行をサポート
- リアルタイムなメッセージ配信（1秒以内）
- 効率的なリソース使用

### セキュリティ
- Slack 署名による認証
- ローカルホストのみの MCP 接続（設定可能）
- 適切な権限管理

### 可用性
- 自動エラーリカバリー
- グレースフルシャットダウン
- セッションの自動クリーンアップ

### 運用性
- 構造化ログ出力
- メトリクス収集
- ヘルスチェック

## 期待される成果

1. **Slack ネイティブな Claude Code 体験**
   - ターミナルを開かずに AI アシスタントを活用
   - チーム全体で AI の活用状況を可視化

2. **非同期ワークフローの実現**
   - 長時間タスクも Slack で管理
   - どこからでも進捗確認・指示が可能

3. **チーム協働の促進**
   - AI アシスタントの民主化
   - 知識の共有と蓄積

4. **「ゴロ寝コンピューティング」の部分的実現**
   - approval_prompt により、モバイルから承認可能
   - 完全なリモート開発体験への第一歩

## ユーザーストーリー

### 開発者として
- Slack でメンションするだけで Claude Code を起動したい
- 作業の進捗を Slack で確認したい
- 危険な操作は Slack で承認したい
- 過去のセッションを再開したい

### チームリーダーとして
- チームの AI 活用状況を把握したい
- コスト管理をしたい
- 作業履歴を監査したい

### 非技術者として
- 技術的な質問を Claude に聞きたい
- 簡単なスクリプトを作成してもらいたい
- 作業の結果を Slack で受け取りたい

## 成功指標

- セッション開始時間: 5秒以内
- メッセージ配信遅延: 1秒以内
- セッション成功率: 95%以上
- ユーザー満足度: 4.0/5.0 以上

## 制約事項

### 現在のサポート範囲
- stream-json 形式はテキストのみのユーザーメッセージに限定
- 画像やファイル添付は未サポート
- Slack Socket Mode は未対応（Webhook のみ）

### 技術的制約
- Claude Code CLI の存在が前提
- SQLite データベース（他DBは将来対応）
- 単一インスタンスでの動作（水平スケーリングは将来対応）

## ロードマップ

### Phase 1: MVP（基本機能）
- Slack メンション対応
- 基本的なコマンド実行
- セッション管理

### Phase 2: 実用性向上
- 承認フロー強化
- エラーハンドリング改善
- セッション永続化

### Phase 3: チーム機能
- 複数ユーザー対応
- 権限管理
- 利用統計

### Phase 4: エンタープライズ対応
- Slack Enterprise Grid対応
- 監査ログ
- コンプライアンス機能