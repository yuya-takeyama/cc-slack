#!/bin/bash

set -euo pipefail

# Change to project root
cd "$(dirname "$0")/.."

echo "ðŸ”¨ Building cc-slack..."

# Build frontend
echo "ðŸ“¦ Building frontend..."
cd web

# Check if node_modules exists, if not install dependencies
if [ ! -d "node_modules" ]; then
    echo "ðŸ“¥ Installing frontend dependencies..."
    pnpm install --frozen-lockfile
fi

pnpm build
cd ..

# Copy frontend dist to internal/web
echo "ðŸ“‹ Copying frontend dist..."
rm -rf internal/web/dist
cp -r web/dist internal/web/

# Build backend
echo "ðŸ”§ Building backend..."
go build -o cc-slack ./cmd/cc-slack

echo "âœ… Build complete! Binary: ./cc-slack"